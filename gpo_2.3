--[[
    âš“ GPO Utility Hub v3 â€” Mega Edition
    Grand Piece Online Feature-Packed Script
    
    Load via:
    loadstring(game:HttpService():GetAsync("https://raw.githubusercontent.com/YOUR_USERNAME/YOUR_REPO/main/gpo.lua"))()
    
    Toggle UI: Right Control
    
    FEATURES:
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    PLAYER:
      â€¢ Speed Boost (Shift)       â€¢ Infinite Jump
      â€¢ No Fall Damage             â€¢ Infinite Stamina
      â€¢ No Dodge Cooldown          â€¢ Fly / Noclip
      â€¢ Walk on Water              â€¢ Walk on Air
      â€¢ Anti AFK                   â€¢ God Mode (Client)
    
    ESP:
      â€¢ Player ESP (Enhanced)      â€¢ Devil Fruit ESP
      â€¢ Chest ESP                  â€¢ NPC / Mob ESP
      â€¢ Island ESP (Markers)
    
    VISUALS:
      â€¢ Fullbright                 â€¢ No Fog
      â€¢ Always Day                 â€¢ Remove Water Effects
    
    TELEPORT:
      â€¢ Island Teleports           â€¢ Teleport to Sea
      â€¢ Teleport to Closest Fruit  â€¢ Teleport to Closest Chest
    
    FARMING:
      â€¢ Auto Punch NPC             â€¢ Collect Nearby Items
      â€¢ Auto Farm Barrels
    
    UTILITY:
      â€¢ Rejoin Server              â€¢ Copy Server ID
      â€¢ FPS Booster                â€¢ Hide Name
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
]]

-- ============================================
-- SERVICES
-- ============================================
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local TweenService = game:GetService("TweenService")
local Lighting = game:GetService("Lighting")
local Workspace = game:GetService("Workspace")
local StarterGui = game:GetService("StarterGui")
local TeleportService = game:GetService("TeleportService")
local VirtualInputManager = game:GetService("VirtualInputManager")

local LocalPlayer = Players.LocalPlayer
local Character = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
local HumanoidRootPart = Character:WaitForChild("HumanoidRootPart")
local Humanoid = Character:WaitForChild("Humanoid")

-- Reconnect on respawn
LocalPlayer.CharacterAdded:Connect(function(char)
    Character = char
    HumanoidRootPart = char:WaitForChild("HumanoidRootPart")
    Humanoid = char:WaitForChild("Humanoid")
end)

-- ============================================
-- DESTROY OLD GUI IF RE-EXECUTING
-- ============================================
if game:GetService("CoreGui"):FindFirstChild("GPOHubV3") then
    game:GetService("CoreGui"):FindFirstChild("GPOHubV3"):Destroy()
end
if LocalPlayer:FindFirstChild("PlayerGui") and LocalPlayer.PlayerGui:FindFirstChild("GPOHubV3") then
    LocalPlayer.PlayerGui:FindFirstChild("GPOHubV3"):Destroy()
end

-- ============================================
-- UI FRAMEWORK
-- ============================================
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "GPOHubV3"
ScreenGui.ResetOnSpawn = false
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

pcall(function()
    ScreenGui.Parent = game:GetService("CoreGui")
end)
if not ScreenGui.Parent then
    ScreenGui.Parent = LocalPlayer:WaitForChild("PlayerGui")
end

-- Color Theme
local THEME = {
    BG = Color3.fromRGB(15, 15, 25),
    SIDEBAR = Color3.fromRGB(20, 18, 32),
    TOPBAR = Color3.fromRGB(22, 20, 35),
    BUTTON = Color3.fromRGB(30, 28, 45),
    BUTTON_ACTIVE = Color3.fromRGB(55, 35, 95),
    ACCENT = Color3.fromRGB(140, 90, 230),
    ACCENT_BRIGHT = Color3.fromRGB(180, 140, 255),
    TEXT = Color3.fromRGB(210, 210, 220),
    TEXT_DIM = Color3.fromRGB(130, 130, 150),
    GREEN = Color3.fromRGB(80, 220, 120),
    RED = Color3.fromRGB(220, 60, 60),
    YELLOW = Color3.fromRGB(240, 200, 60),
    ORANGE = Color3.fromRGB(240, 150, 50),
    CYAN = Color3.fromRGB(60, 200, 240),
    PINK = Color3.fromRGB(240, 100, 180),
}

-- Main Frame
local MainFrame = Instance.new("Frame")
MainFrame.Name = "MainFrame"
MainFrame.Size = UDim2.new(0, 520, 0, 480)
MainFrame.Position = UDim2.new(0.5, -260, 0.5, -240)
MainFrame.BackgroundColor3 = THEME.BG
MainFrame.BorderSizePixel = 0
MainFrame.Active = true
MainFrame.Draggable = true
MainFrame.ClipsDescendants = true
MainFrame.Parent = ScreenGui

Instance.new("UICorner", MainFrame).CornerRadius = UDim.new(0, 12)
local mainStroke = Instance.new("UIStroke", MainFrame)
mainStroke.Color = THEME.ACCENT
mainStroke.Thickness = 1.5
mainStroke.Transparency = 0.3

-- Drop Shadow (faked)
local Shadow = Instance.new("ImageLabel")
Shadow.Name = "Shadow"
Shadow.Size = UDim2.new(1, 30, 1, 30)
Shadow.Position = UDim2.new(0, -15, 0, -15)
Shadow.BackgroundTransparency = 1
Shadow.Image = "rbxassetid://6015897843"
Shadow.ImageColor3 = Color3.new(0, 0, 0)
Shadow.ImageTransparency = 0.5
Shadow.ScaleType = Enum.ScaleType.Slice
Shadow.SliceCenter = Rect.new(49, 49, 450, 450)
Shadow.ZIndex = -1
Shadow.Parent = MainFrame

-- ============================================
-- TOP BAR
-- ============================================
local TopBar = Instance.new("Frame")
TopBar.Size = UDim2.new(1, 0, 0, 42)
TopBar.BackgroundColor3 = THEME.TOPBAR
TopBar.BorderSizePixel = 0
TopBar.Parent = MainFrame

local topCorner = Instance.new("UICorner", TopBar)
topCorner.CornerRadius = UDim.new(0, 12)

-- Fix bottom corners of topbar
local TopBarFix = Instance.new("Frame")
TopBarFix.Size = UDim2.new(1, 0, 0, 12)
TopBarFix.Position = UDim2.new(0, 0, 1, -12)
TopBarFix.BackgroundColor3 = THEME.TOPBAR
TopBarFix.BorderSizePixel = 0
TopBarFix.Parent = TopBar

local Title = Instance.new("TextLabel")
Title.Size = UDim2.new(1, -80, 1, 0)
Title.Position = UDim2.new(0, 14, 0, 0)
Title.BackgroundTransparency = 1
Title.Text = "âš“  GPO UTILITY HUB  v3"
Title.TextColor3 = THEME.ACCENT_BRIGHT
Title.TextSize = 16
Title.Font = Enum.Font.GothamBold
Title.TextXAlignment = Enum.TextXAlignment.Left
Title.Parent = TopBar

-- Minimize Button
local MinBtn = Instance.new("TextButton")
MinBtn.Size = UDim2.new(0, 28, 0, 28)
MinBtn.Position = UDim2.new(1, -68, 0, 7)
MinBtn.BackgroundColor3 = THEME.YELLOW
MinBtn.Text = "â€”"
MinBtn.TextColor3 = Color3.fromRGB(30, 30, 30)
MinBtn.TextSize = 16
MinBtn.Font = Enum.Font.GothamBold
MinBtn.BorderSizePixel = 0
MinBtn.Parent = TopBar
Instance.new("UICorner", MinBtn).CornerRadius = UDim.new(0, 6)

-- Close Button
local CloseBtn = Instance.new("TextButton")
CloseBtn.Size = UDim2.new(0, 28, 0, 28)
CloseBtn.Position = UDim2.new(1, -35, 0, 7)
CloseBtn.BackgroundColor3 = THEME.RED
CloseBtn.Text = "âœ•"
CloseBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
CloseBtn.TextSize = 12
CloseBtn.Font = Enum.Font.GothamBold
CloseBtn.BorderSizePixel = 0
CloseBtn.Parent = TopBar
Instance.new("UICorner", CloseBtn).CornerRadius = UDim.new(0, 6)

local minimized = false
MinBtn.MouseButton1Click:Connect(function()
    minimized = not minimized
    if minimized then
        TweenService:Create(MainFrame, TweenInfo.new(0.3, Enum.EasingStyle.Quart), {Size = UDim2.new(0, 520, 0, 42)}):Play()
    else
        TweenService:Create(MainFrame, TweenInfo.new(0.3, Enum.EasingStyle.Quart), {Size = UDim2.new(0, 520, 0, 480)}):Play()
    end
end)

CloseBtn.MouseButton1Click:Connect(function()
    ScreenGui:Destroy()
end)

-- ============================================
-- SIDEBAR (TABS)
-- ============================================
local Sidebar = Instance.new("Frame")
Sidebar.Size = UDim2.new(0, 120, 1, -42)
Sidebar.Position = UDim2.new(0, 0, 0, 42)
Sidebar.BackgroundColor3 = THEME.SIDEBAR
Sidebar.BorderSizePixel = 0
Sidebar.Parent = MainFrame

local SidebarLayout = Instance.new("UIListLayout", Sidebar)
SidebarLayout.Padding = UDim.new(0, 2)
SidebarLayout.SortOrder = Enum.SortOrder.LayoutOrder
SidebarLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center

local SidebarPad = Instance.new("UIPadding", Sidebar)
SidebarPad.PaddingTop = UDim.new(0, 8)
SidebarPad.PaddingLeft = UDim.new(0, 6)
SidebarPad.PaddingRight = UDim.new(0, 6)

-- Content Area
local ContentArea = Instance.new("Frame")
ContentArea.Size = UDim2.new(1, -120, 1, -42)
ContentArea.Position = UDim2.new(0, 120, 0, 42)
ContentArea.BackgroundColor3 = THEME.BG
ContentArea.BorderSizePixel = 0
ContentArea.Parent = MainFrame

-- ============================================
-- TAB SYSTEM
-- ============================================
local tabs = {}
local tabFrames = {}
local activeTab = nil

local TAB_INFO = {
    {name = "Player", icon = "ğŸƒ", order = 1},
    {name = "ESP", icon = "ğŸ‘", order = 2},
    {name = "Visuals", icon = "ğŸ¨", order = 3},
    {name = "Teleport", icon = "ğŸŒ€", order = 4},
    {name = "Farm", icon = "âš”", order = 5},
    {name = "Utility", icon = "ğŸ”§", order = 6},
}

local function CreateTab(info)
    -- Tab Button
    local TabBtn = Instance.new("TextButton")
    TabBtn.Size = UDim2.new(1, 0, 0, 36)
    TabBtn.BackgroundColor3 = THEME.SIDEBAR
    TabBtn.Text = info.icon .. "  " .. info.name
    TabBtn.TextColor3 = THEME.TEXT_DIM
    TabBtn.TextSize = 13
    TabBtn.Font = Enum.Font.GothamSemibold
    TabBtn.TextXAlignment = Enum.TextXAlignment.Left
    TabBtn.BorderSizePixel = 0
    TabBtn.LayoutOrder = info.order
    TabBtn.AutoButtonColor = false
    TabBtn.Parent = Sidebar
    Instance.new("UICorner", TabBtn).CornerRadius = UDim.new(0, 8)
    
    local pad = Instance.new("UIPadding", TabBtn)
    pad.PaddingLeft = UDim.new(0, 8)

    -- Tab Content (ScrollingFrame)
    local TabFrame = Instance.new("ScrollingFrame")
    TabFrame.Size = UDim2.new(1, -16, 1, -16)
    TabFrame.Position = UDim2.new(0, 8, 0, 8)
    TabFrame.BackgroundTransparency = 1
    TabFrame.ScrollBarThickness = 3
    TabFrame.ScrollBarImageColor3 = THEME.ACCENT
    TabFrame.CanvasSize = UDim2.new(0, 0, 0, 0)
    TabFrame.AutomaticCanvasSize = Enum.AutomaticSize.Y
    TabFrame.Visible = false
    TabFrame.Parent = ContentArea

    local layout = Instance.new("UIListLayout", TabFrame)
    layout.Padding = UDim.new(0, 5)
    layout.SortOrder = Enum.SortOrder.LayoutOrder

    tabs[info.name] = TabBtn
    tabFrames[info.name] = TabFrame

    TabBtn.MouseButton1Click:Connect(function()
        -- Deactivate all
        for n, btn in pairs(tabs) do
            btn.BackgroundColor3 = THEME.SIDEBAR
            btn.TextColor3 = THEME.TEXT_DIM
            tabFrames[n].Visible = false
        end
        -- Activate this
        TabBtn.BackgroundColor3 = THEME.BUTTON_ACTIVE
        TabBtn.TextColor3 = THEME.ACCENT_BRIGHT
        TabFrame.Visible = true
        activeTab = info.name
    end)

    return TabFrame
end

-- Create all tabs
local playerTab = CreateTab(TAB_INFO[1])
local espTab = CreateTab(TAB_INFO[2])
local visualsTab = CreateTab(TAB_INFO[3])
local teleportTab = CreateTab(TAB_INFO[4])
local farmTab = CreateTab(TAB_INFO[5])
local utilityTab = CreateTab(TAB_INFO[6])

-- Default to Player tab
tabs["Player"].BackgroundColor3 = THEME.BUTTON_ACTIVE
tabs["Player"].TextColor3 = THEME.ACCENT_BRIGHT
tabFrames["Player"].Visible = true
activeTab = "Player"

-- ============================================
-- UI ELEMENT CREATORS
-- ============================================
local function CreateSectionLabel(parent, text)
    local label = Instance.new("TextLabel")
    label.Size = UDim2.new(1, 0, 0, 24)
    label.BackgroundTransparency = 1
    label.Text = "  " .. string.upper(text)
    label.TextColor3 = THEME.ACCENT
    label.TextSize = 11
    label.Font = Enum.Font.GothamBold
    label.TextXAlignment = Enum.TextXAlignment.Left
    label.Parent = parent
    return label
end

local function CreateToggle(parent, name, callback)
    local toggled = false

    local Container = Instance.new("Frame")
    Container.Size = UDim2.new(1, 0, 0, 34)
    Container.BackgroundColor3 = THEME.BUTTON
    Container.BorderSizePixel = 0
    Container.Parent = parent
    Instance.new("UICorner", Container).CornerRadius = UDim.new(0, 8)

    local Label = Instance.new("TextLabel")
    Label.Size = UDim2.new(1, -60, 1, 0)
    Label.Position = UDim2.new(0, 12, 0, 0)
    Label.BackgroundTransparency = 1
    Label.Text = name
    Label.TextColor3 = THEME.TEXT
    Label.TextSize = 13
    Label.Font = Enum.Font.GothamSemibold
    Label.TextXAlignment = Enum.TextXAlignment.Left
    Label.Parent = Container

    -- Toggle Switch
    local SwitchBG = Instance.new("Frame")
    SwitchBG.Size = UDim2.new(0, 38, 0, 20)
    SwitchBG.Position = UDim2.new(1, -50, 0.5, -10)
    SwitchBG.BackgroundColor3 = Color3.fromRGB(50, 50, 60)
    SwitchBG.BorderSizePixel = 0
    SwitchBG.Parent = Container
    Instance.new("UICorner", SwitchBG).CornerRadius = UDim.new(1, 0)

    local SwitchKnob = Instance.new("Frame")
    SwitchKnob.Size = UDim2.new(0, 16, 0, 16)
    SwitchKnob.Position = UDim2.new(0, 2, 0.5, -8)
    SwitchKnob.BackgroundColor3 = Color3.fromRGB(150, 150, 160)
    SwitchKnob.BorderSizePixel = 0
    SwitchKnob.Parent = SwitchBG
    Instance.new("UICorner", SwitchKnob).CornerRadius = UDim.new(1, 0)

    local Btn = Instance.new("TextButton")
    Btn.Size = UDim2.new(1, 0, 1, 0)
    Btn.BackgroundTransparency = 1
    Btn.Text = ""
    Btn.Parent = Container

    Btn.MouseButton1Click:Connect(function()
        toggled = not toggled
        if toggled then
            TweenService:Create(SwitchBG, TweenInfo.new(0.2), {BackgroundColor3 = THEME.ACCENT}):Play()
            TweenService:Create(SwitchKnob, TweenInfo.new(0.2), {Position = UDim2.new(1, -18, 0.5, -8), BackgroundColor3 = Color3.fromRGB(255, 255, 255)}):Play()
            TweenService:Create(Container, TweenInfo.new(0.2), {BackgroundColor3 = THEME.BUTTON_ACTIVE}):Play()
        else
            TweenService:Create(SwitchBG, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(50, 50, 60)}):Play()
            TweenService:Create(SwitchKnob, TweenInfo.new(0.2), {Position = UDim2.new(0, 2, 0.5, -8), BackgroundColor3 = Color3.fromRGB(150, 150, 160)}):Play()
            TweenService:Create(Container, TweenInfo.new(0.2), {BackgroundColor3 = THEME.BUTTON}):Play()
        end
        callback(toggled)
    end)

    return Container
end

local function CreateButton(parent, name, callback)
    local Btn = Instance.new("TextButton")
    Btn.Size = UDim2.new(1, 0, 0, 34)
    Btn.BackgroundColor3 = THEME.BUTTON
    Btn.Text = "  â–¶  " .. name
    Btn.TextColor3 = THEME.TEXT
    Btn.TextSize = 13
    Btn.Font = Enum.Font.GothamSemibold
    Btn.TextXAlignment = Enum.TextXAlignment.Left
    Btn.BorderSizePixel = 0
    Btn.AutoButtonColor = false
    Btn.Parent = parent
    Instance.new("UICorner", Btn).CornerRadius = UDim.new(0, 8)

    Btn.MouseEnter:Connect(function()
        TweenService:Create(Btn, TweenInfo.new(0.15), {BackgroundColor3 = THEME.BUTTON_ACTIVE}):Play()
    end)
    Btn.MouseLeave:Connect(function()
        TweenService:Create(Btn, TweenInfo.new(0.15), {BackgroundColor3 = THEME.BUTTON}):Play()
    end)

    Btn.MouseButton1Click:Connect(function()
        -- Flash effect
        TweenService:Create(Btn, TweenInfo.new(0.1), {BackgroundColor3 = THEME.ACCENT}):Play()
        task.delay(0.15, function()
            TweenService:Create(Btn, TweenInfo.new(0.1), {BackgroundColor3 = THEME.BUTTON}):Play()
        end)
        callback()
    end)

    return Btn
end

local function CreateSlider(parent, name, min, max, default, callback)
    local value = default

    local Container = Instance.new("Frame")
    Container.Size = UDim2.new(1, 0, 0, 50)
    Container.BackgroundColor3 = THEME.BUTTON
    Container.BorderSizePixel = 0
    Container.Parent = parent
    Instance.new("UICorner", Container).CornerRadius = UDim.new(0, 8)

    local Label = Instance.new("TextLabel")
    Label.Size = UDim2.new(1, -60, 0, 22)
    Label.Position = UDim2.new(0, 12, 0, 2)
    Label.BackgroundTransparency = 1
    Label.Text = name
    Label.TextColor3 = THEME.TEXT
    Label.TextSize = 12
    Label.Font = Enum.Font.GothamSemibold
    Label.TextXAlignment = Enum.TextXAlignment.Left
    Label.Parent = Container

    local ValueLabel = Instance.new("TextLabel")
    ValueLabel.Size = UDim2.new(0, 50, 0, 22)
    ValueLabel.Position = UDim2.new(1, -58, 0, 2)
    ValueLabel.BackgroundTransparency = 1
    ValueLabel.Text = tostring(default)
    ValueLabel.TextColor3 = THEME.ACCENT_BRIGHT
    ValueLabel.TextSize = 12
    ValueLabel.Font = Enum.Font.GothamBold
    ValueLabel.Parent = Container

    local SliderBG = Instance.new("Frame")
    SliderBG.Size = UDim2.new(1, -24, 0, 6)
    SliderBG.Position = UDim2.new(0, 12, 0, 32)
    SliderBG.BackgroundColor3 = Color3.fromRGB(40, 40, 55)
    SliderBG.BorderSizePixel = 0
    SliderBG.Parent = Container
    Instance.new("UICorner", SliderBG).CornerRadius = UDim.new(1, 0)

    local SliderFill = Instance.new("Frame")
    SliderFill.Size = UDim2.new((default - min) / (max - min), 0, 1, 0)
    SliderFill.BackgroundColor3 = THEME.ACCENT
    SliderFill.BorderSizePixel = 0
    SliderFill.Parent = SliderBG
    Instance.new("UICorner", SliderFill).CornerRadius = UDim.new(1, 0)

    local SliderBtn = Instance.new("TextButton")
    SliderBtn.Size = UDim2.new(1, 0, 1, 12)
    SliderBtn.Position = UDim2.new(0, 0, 0, -6)
    SliderBtn.BackgroundTransparency = 1
    SliderBtn.Text = ""
    SliderBtn.Parent = SliderBG

    local dragging = false

    SliderBtn.MouseButton1Down:Connect(function()
        dragging = true
    end)

    UserInputService.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = false
        end
    end)

    UserInputService.InputChanged:Connect(function(input)
        if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
            local absPos = SliderBG.AbsolutePosition.X
            local absSize = SliderBG.AbsoluteSize.X
            local mouseX = input.Position.X
            local pct = math.clamp((mouseX - absPos) / absSize, 0, 1)
            value = math.floor(min + (max - min) * pct)
            SliderFill.Size = UDim2.new(pct, 0, 1, 0)
            ValueLabel.Text = tostring(value)
            callback(value)
        end
    end)

    return Container
end

-- ============================================
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- PLAYER TAB FEATURES
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- ============================================

CreateSectionLabel(playerTab, "Movement")

-- Speed Boost
local sprintConn
CreateToggle(playerTab, "Speed Boost (Hold Shift)", function(state)
    if state then
        sprintConn = RunService.RenderStepped:Connect(function()
            if Humanoid and UserInputService:IsKeyDown(Enum.KeyCode.LeftShift) then
                Humanoid.WalkSpeed = 80
            elseif Humanoid then
                Humanoid.WalkSpeed = 16
            end
        end)
    else
        if sprintConn then sprintConn:Disconnect() end
        if Humanoid then Humanoid.WalkSpeed = 16 end
    end
end)

-- Walk Speed Slider
CreateSlider(playerTab, "Walk Speed", 16, 200, 16, function(val)
    if Humanoid then
        Humanoid.WalkSpeed = val
    end
end)

-- Jump Power Slider
CreateSlider(playerTab, "Jump Power", 50, 300, 50, function(val)
    if Humanoid then
        Humanoid.JumpPower = val
    end
end)

-- Infinite Jump
local infJumpConn
CreateToggle(playerTab, "Infinite Jump", function(state)
    if state then
        infJumpConn = UserInputService.JumpRequest:Connect(function()
            if Humanoid then
                Humanoid:ChangeState(Enum.HumanoidStateType.Jumping)
            end
        end)
    else
        if infJumpConn then infJumpConn:Disconnect() end
    end
end)

-- No Fall Damage
local noFallConn
CreateToggle(playerTab, "No Fall Damage", function(state)
    if state then
        noFallConn = RunService.Heartbeat:Connect(function()
            if Humanoid then
                Humanoid:SetStateEnabled(Enum.HumanoidStateType.FallingDown, false)
                Humanoid:SetStateEnabled(Enum.HumanoidStateType.Ragdoll, false)
            end
        end)
    else
        if noFallConn then noFallConn:Disconnect() end
        if Humanoid then
            Humanoid:SetStateEnabled(Enum.HumanoidStateType.FallingDown, true)
            Humanoid:SetStateEnabled(Enum.HumanoidStateType.Ragdoll, true)
        end
    end
end)

-- Infinite Stamina
local infStaminaConn
CreateToggle(playerTab, "Infinite Stamina", function(state)
    if state then
        infStaminaConn = RunService.Heartbeat:Connect(function()
            pcall(function()
                local staminaGui = LocalPlayer.PlayerGui:FindFirstChild("Stamina") or LocalPlayer.PlayerGui:FindFirstChild("StaminaGui")
                if staminaGui then
                    for _, desc in pairs(staminaGui:GetDescendants()) do
                        if desc.Name == "Stamina" and desc:IsA("NumberValue") then
                            desc.Value = 1000
                        end
                    end
                end
                -- Also try character stamina values
                for _, desc in pairs(Character:GetDescendants()) do
                    if (desc.Name:lower():find("stamina") or desc.Name:lower():find("energy")) and desc:IsA("NumberValue") then
                        desc.Value = desc.Value + 100
                    end
                end
            end)
        end)
    else
        if infStaminaConn then infStaminaConn:Disconnect() end
    end
end)

-- No Dodge Cooldown
local noDodgeConn
CreateToggle(playerTab, "No Dodge Cooldown", function(state)
    if state then
        noDodgeConn = RunService.Heartbeat:Connect(function()
            pcall(function()
                for _, desc in pairs(Character:GetDescendants()) do
                    if (desc.Name:lower():find("dodge") or desc.Name:lower():find("roll") or desc.Name:lower():find("cooldown")) and desc:IsA("NumberValue") then
                        desc.Value = 0
                    end
                    if desc.Name:lower():find("dodge") and desc:IsA("BoolValue") then
                        desc.Value = false
                    end
                end
            end)
        end)
    else
        if noDodgeConn then noDodgeConn:Disconnect() end
    end
end)

CreateSectionLabel(playerTab, "Special Movement")

-- Fly / Noclip
local flyEnabled = false
local flySpeed = 80
local flyConn, noclipConn
local flyBodyVel, flyBodyGyro

CreateToggle(playerTab, "Fly (Press E to toggle)", function(state)
    flyEnabled = state
    if state then
        -- Noclip
        noclipConn = RunService.Stepped:Connect(function()
            if Character then
                for _, part in pairs(Character:GetDescendants()) do
                    if part:IsA("BasePart") then
                        part.CanCollide = false
                    end
                end
            end
        end)

        flyConn = RunService.RenderStepped:Connect(function()
            if not flyEnabled then return end
            if not HumanoidRootPart then return end
            
            if not flyBodyVel or not flyBodyVel.Parent then
                flyBodyVel = Instance.new("BodyVelocity")
                flyBodyVel.MaxForce = Vector3.new(math.huge, math.huge, math.huge)
                flyBodyVel.Velocity = Vector3.new(0, 0, 0)
                flyBodyVel.Parent = HumanoidRootPart
            end
            if not flyBodyGyro or not flyBodyGyro.Parent then
                flyBodyGyro = Instance.new("BodyGyro")
                flyBodyGyro.MaxTorque = Vector3.new(math.huge, math.huge, math.huge)
                flyBodyGyro.P = 9e4
                flyBodyGyro.Parent = HumanoidRootPart
            end

            local camera = workspace.CurrentCamera
            local direction = Vector3.new(0, 0, 0)

            if UserInputService:IsKeyDown(Enum.KeyCode.W) then
                direction = direction + camera.CFrame.LookVector
            end
            if UserInputService:IsKeyDown(Enum.KeyCode.S) then
                direction = direction - camera.CFrame.LookVector
            end
            if UserInputService:IsKeyDown(Enum.KeyCode.A) then
                direction = direction - camera.CFrame.RightVector
            end
            if UserInputService:IsKeyDown(Enum.KeyCode.D) then
                direction = direction + camera.CFrame.RightVector
            end
            if UserInputService:IsKeyDown(Enum.KeyCode.Space) then
                direction = direction + Vector3.new(0, 1, 0)
            end
            if UserInputService:IsKeyDown(Enum.KeyCode.LeftControl) then
                direction = direction - Vector3.new(0, 1, 0)
            end

            if direction.Magnitude > 0 then
                direction = direction.Unit * flySpeed
            end

            flyBodyVel.Velocity = direction
            flyBodyGyro.CFrame = camera.CFrame
        end)
    else
        if flyConn then flyConn:Disconnect() end
        if noclipConn then noclipConn:Disconnect() end
        if flyBodyVel then flyBodyVel:Destroy() flyBodyVel = nil end
        if flyBodyGyro then flyBodyGyro:Destroy() flyBodyGyro = nil end
    end
end)

CreateSlider(playerTab, "Fly Speed", 20, 300, 80, function(val)
    flySpeed = val
end)

-- Walk on Water
local waterWalkConn, waterPart
CreateToggle(playerTab, "Walk on Water", function(state)
    if state then
        waterPart = Instance.new("Part")
        waterPart.Size = Vector3.new(500, 1, 500)
        waterPart.Anchored = true
        waterPart.Transparency = 0.8
        waterPart.Material = Enum.Material.ForceField
        waterPart.Color = Color3.fromRGB(60, 120, 200)
        waterPart.CanCollide = true
        waterPart.Parent = workspace

        waterWalkConn = RunService.Heartbeat:Connect(function()
            if HumanoidRootPart then
                local waterLevel = workspace.Terrain:GetMaterialColor(Enum.Material.Water) and 15 or 15
                waterPart.Position = Vector3.new(HumanoidRootPart.Position.X, 14.5, HumanoidRootPart.Position.Z)
            end
        end)
    else
        if waterWalkConn then waterWalkConn:Disconnect() end
        if waterPart then waterPart:Destroy() end
    end
end)

-- Walk on Air
local airWalkConn, airPart
CreateToggle(playerTab, "Walk on Air", function(state)
    if state then
        airPart = Instance.new("Part")
        airPart.Size = Vector3.new(14, 0.5, 14)
        airPart.Anchored = true
        airPart.Transparency = 0.9
        airPart.Material = Enum.Material.ForceField
        airPart.CanCollide = true
        airPart.Parent = workspace

        airWalkConn = RunService.Heartbeat:Connect(function()
            if HumanoidRootPart then
                airPart.Position = HumanoidRootPart.Position - Vector3.new(0, 3.5, 0)
            end
        end)
    else
        if airWalkConn then airWalkConn:Disconnect() end
        if airPart then airPart:Destroy() end
    end
end)

CreateSectionLabel(playerTab, "Combat")

-- God Mode (Client Side)
local godModeConn
CreateToggle(playerTab, "God Mode (Client)", function(state)
    if state then
        godModeConn = RunService.Heartbeat:Connect(function()
            if Humanoid then
                Humanoid.Health = Humanoid.MaxHealth
            end
        end)
    else
        if godModeConn then godModeConn:Disconnect() end
    end
end)

-- ============================================
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- ESP TAB FEATURES
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- ============================================

CreateSectionLabel(espTab, "Player ESP")

-- Enhanced Player ESP
local espEnabled = false
local espObjects = {}

CreateToggle(espTab, "Player ESP (Highlight + Info)", function(state)
    espEnabled = state
    if not state then
        for _, data in pairs(espObjects) do
            pcall(function() if data.highlight then data.highlight:Destroy() end end)
            pcall(function() if data.billboard then data.billboard:Destroy() end end)
        end
        espObjects = {}
    end
end)

local function CreatePlayerESP(player)
    if player == LocalPlayer then return end

    local function setup(char)
        if espObjects[player] then
            pcall(function() if espObjects[player].highlight then espObjects[player].highlight:Destroy() end end)
            pcall(function() if espObjects[player].billboard then espObjects[player].billboard:Destroy() end end)
        end

        local hrp = char:WaitForChild("HumanoidRootPart", 5)
        local head = char:WaitForChild("Head", 5)
        local hum = char:WaitForChild("Humanoid", 5)
        if not hrp or not head or not hum then return end

        local highlight = Instance.new("Highlight")
        highlight.FillColor = Color3.fromRGB(120, 70, 200)
        highlight.FillTransparency = 0.7
        highlight.OutlineColor = THEME.ACCENT_BRIGHT
        highlight.OutlineTransparency = 0.3
        highlight.Adornee = char
        highlight.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop
        highlight.Enabled = espEnabled
        highlight.Parent = char

        local billboard = Instance.new("BillboardGui")
        billboard.Size = UDim2.new(0, 200, 0, 60)
        billboard.StudsOffset = Vector3.new(0, 3.5, 0)
        billboard.AlwaysOnTop = true
        billboard.Adornee = head
        billboard.Enabled = espEnabled
        billboard.Parent = head

        local nameLabel = Instance.new("TextLabel")
        nameLabel.Size = UDim2.new(1, 0, 0.45, 0)
        nameLabel.BackgroundTransparency = 1
        nameLabel.Text = player.Name
        nameLabel.TextColor3 = THEME.ACCENT_BRIGHT
        nameLabel.TextSize = 14
        nameLabel.Font = Enum.Font.GothamBold
        nameLabel.TextStrokeTransparency = 0.3
        nameLabel.TextStrokeColor3 = Color3.new(0, 0, 0)
        nameLabel.Parent = billboard

        local infoLabel = Instance.new("TextLabel")
        infoLabel.Size = UDim2.new(1, 0, 0.35, 0)
        infoLabel.Position = UDim2.new(0, 0, 0.45, 0)
        infoLabel.BackgroundTransparency = 1
        infoLabel.TextColor3 = THEME.TEXT
        infoLabel.TextSize = 11
        infoLabel.Font = Enum.Font.GothamSemibold
        infoLabel.TextStrokeTransparency = 0.4
        infoLabel.Parent = billboard

        local healthBg = Instance.new("Frame")
        healthBg.Size = UDim2.new(0.6, 0, 0, 5)
        healthBg.Position = UDim2.new(0.2, 0, 0.85, 0)
        healthBg.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
        healthBg.BorderSizePixel = 0
        healthBg.Parent = billboard
        Instance.new("UICorner", healthBg).CornerRadius = UDim.new(1, 0)

        local healthBar = Instance.new("Frame")
        healthBar.Size = UDim2.new(1, 0, 1, 0)
        healthBar.BackgroundColor3 = THEME.GREEN
        healthBar.BorderSizePixel = 0
        healthBar.Parent = healthBg
        Instance.new("UICorner", healthBar).CornerRadius = UDim.new(1, 0)

        espObjects[player] = {
            highlight = highlight,
            billboard = billboard,
            infoLabel = infoLabel,
            healthBar = healthBar,
            humanoid = hum,
            hrp = hrp
        }
    end

    if player.Character then setup(player.Character) end
    player.CharacterAdded:Connect(setup)
end

for _, p in pairs(Players:GetPlayers()) do CreatePlayerESP(p) end
Players.PlayerAdded:Connect(CreatePlayerESP)
Players.PlayerRemoving:Connect(function(player)
    if espObjects[player] then
        pcall(function() espObjects[player].highlight:Destroy() end)
        pcall(function() espObjects[player].billboard:Destroy() end)
        espObjects[player] = nil
    end
end)

-- Update player ESP
RunService.RenderStepped:Connect(function()
    if not espEnabled then return end
    if not Character or not Character:FindFirstChild("HumanoidRootPart") then return end

    for player, data in pairs(espObjects) do
        pcall(function()
            if data.hrp and data.humanoid and data.infoLabel and data.healthBar then
                local dist = math.floor((HumanoidRootPart.Position - data.hrp.Position).Magnitude)
                local hp = math.floor(data.humanoid.Health)
                local maxHp = math.floor(data.humanoid.MaxHealth)
                local pct = data.humanoid.Health / data.humanoid.MaxHealth

                data.infoLabel.Text = hp .. "/" .. maxHp .. " HP  â€¢  " .. dist .. "m"
                data.healthBar.Size = UDim2.new(math.clamp(pct, 0, 1), 0, 1, 0)

                if pct > 0.5 then
                    data.healthBar.BackgroundColor3 = THEME.GREEN
                elseif pct > 0.25 then
                    data.healthBar.BackgroundColor3 = THEME.YELLOW
                else
                    data.healthBar.BackgroundColor3 = THEME.RED
                end

                data.highlight.Enabled = espEnabled
                data.billboard.Enabled = espEnabled
            end
        end)
    end
end)

CreateSectionLabel(espTab, "World ESP")

-- Devil Fruit ESP
local fruitEspEnabled = false
local fruitEspFolder = Instance.new("Folder", ScreenGui)
fruitEspFolder.Name = "FruitESP"

CreateToggle(espTab, "Devil Fruit ESP", function(state)
    fruitEspEnabled = state
    if not state then
        for _, v in pairs(fruitEspFolder:GetChildren()) do v:Destroy() end
    end
end)

-- Chest ESP
local chestEspEnabled = false
local chestEspFolder = Instance.new("Folder", ScreenGui)
chestEspFolder.Name = "ChestESP"

CreateToggle(espTab, "Chest ESP", function(state)
    chestEspEnabled = state
    if not state then
        for _, v in pairs(chestEspFolder:GetChildren()) do v:Destroy() end
    end
end)

-- NPC / Mob ESP
local npcEspEnabled = false
local npcEspFolder = Instance.new("Folder", ScreenGui)
npcEspFolder.Name = "NPCESP"

CreateToggle(espTab, "NPC / Mob ESP", function(state)
    npcEspEnabled = state
    if not state then
        for _, v in pairs(npcEspFolder:GetChildren()) do v:Destroy() end
    end
end)

-- Unified ESP Update Loop
RunService.RenderStepped:Connect(function()
    if not Character or not Character:FindFirstChild("HumanoidRootPart") then return end

    -- Devil Fruit ESP
    if fruitEspEnabled then
        for _, v in pairs(fruitEspFolder:GetChildren()) do v:Destroy() end
        for _, obj in pairs(workspace:GetDescendants()) do
            pcall(function()
                if (obj.Name:lower():find("fruit") or obj.Name:lower():find("devil")) and obj:IsA("BasePart") then
                    local pos, onScreen = workspace.CurrentCamera:WorldToViewportPoint(obj.Position)
                    if onScreen then
                        local dist = math.floor((HumanoidRootPart.Position - obj.Position).Magnitude)
                        local label = Instance.new("TextLabel")
                        label.Size = UDim2.new(0, 200, 0, 30)
                        label.Position = UDim2.new(0, pos.X - 100, 0, pos.Y - 30)
                        label.BackgroundTransparency = 1
                        label.Text = "ğŸ " .. obj.Name .. " [" .. dist .. "m]"
                        label.TextColor3 = THEME.ORANGE
                        label.TextSize = 14
                        label.Font = Enum.Font.GothamBold
                        label.TextStrokeTransparency = 0.3
                        label.Parent = fruitEspFolder
                    end
                end
                -- Also check for fruit models
                if obj:IsA("Model") and (obj.Name:lower():find("fruit") or obj.Name:lower():find("devil")) then
                    local part = obj:FindFirstChildWhichIsA("BasePart")
                    if part then
                        local pos, onScreen = workspace.CurrentCamera:WorldToViewportPoint(part.Position)
                        if onScreen then
                            local dist = math.floor((HumanoidRootPart.Position - part.Position).Magnitude)
                            local label = Instance.new("TextLabel")
                            label.Size = UDim2.new(0, 200, 0, 30)
                            label.Position = UDim2.new(0, pos.X - 100, 0, pos.Y - 30)
                            label.BackgroundTransparency = 1
                            label.Text = "ğŸ " .. obj.Name .. " [" .. dist .. "m]"
                            label.TextColor3 = THEME.ORANGE
                            label.TextSize = 14
                            label.Font = Enum.Font.GothamBold
                            label.TextStrokeTransparency = 0.3
                            label.Parent = fruitEspFolder
                        end
                    end
                end
            end)
        end
    else
        for _, v in pairs(fruitEspFolder:GetChildren()) do v:Destroy() end
    end

    -- Chest ESP
    if chestEspEnabled then
        for _, v in pairs(chestEspFolder:GetChildren()) do v:Destroy() end
        for _, obj in pairs(workspace:GetDescendants()) do
            pcall(function()
                if (obj.Name:lower():find("chest") or obj.Name:lower():find("treasure") or obj.Name:lower():find("loot")) and (obj:IsA("BasePart") or obj:IsA("Model")) then
                    local part = obj:IsA("BasePart") and obj or obj:FindFirstChildWhichIsA("BasePart")
                    if part then
                        local pos, onScreen = workspace.CurrentCamera:WorldToViewportPoint(part.Position)
                        if onScreen then
                            local dist = math.floor((HumanoidRootPart.Position - part.Position).Magnitude)
                            local label = Instance.new("TextLabel")
                            label.Size = UDim2.new(0, 200, 0, 30)
                            label.Position = UDim2.new(0, pos.X - 100, 0, pos.Y - 30)
                            label.BackgroundTransparency = 1
                            label.Text = "ğŸ“¦ " .. obj.Name .. " [" .. dist .. "m]"
                            label.TextColor3 = THEME.CYAN
                            label.TextSize = 13
                            label.Font = Enum.Font.GothamBold
                            label.TextStrokeTransparency = 0.3
                            label.Parent = chestEspFolder
                        end
                    end
                end
            end)
        end
    else
        for _, v in pairs(chestEspFolder:GetChildren()) do v:Destroy() end
    end

    -- NPC ESP
    if npcEspEnabled then
        for _, v in pairs(npcEspFolder:GetChildren()) do v:Destroy() end
        for _, obj in pairs(workspace:GetDescendants()) do
            pcall(function()
                if obj:IsA("Model") and obj:FindFirstChildOfClass("Humanoid") and not Players:GetPlayerFromCharacter(obj) then
                    local hum = obj:FindFirstChildOfClass("Humanoid")
                    local hrp = obj:FindFirstChild("HumanoidRootPart") or obj:FindFirstChildWhichIsA("BasePart")
                    if hrp and hum.Health > 0 then
                        local pos, onScreen = workspace.CurrentCamera:WorldToViewportPoint(hrp.Position)
                        if onScreen then
                            local dist = math.floor((HumanoidRootPart.Position - hrp.Position).Magnitude)
                            local hp = math.floor(hum.Health)
                            local label = Instance.new("TextLabel")
                            label.Size = UDim2.new(0, 220, 0, 30)
                            label.Position = UDim2.new(0, pos.X - 110, 0, pos.Y - 30)
                            label.BackgroundTransparency = 1
                            label.Text = "âš” " .. obj.Name .. " [" .. hp .. "HP] [" .. dist .. "m]"
                            label.TextColor3 = THEME.RED
                            label.TextSize = 12
                            label.Font = Enum.Font.GothamBold
                            label.TextStrokeTransparency = 0.3
                            label.Parent = npcEspFolder
                        end
                    end
                end
            end)
        end
    else
        for _, v in pairs(npcEspFolder:GetChildren()) do v:Destroy() end
    end
end)

-- ============================================
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- VISUALS TAB FEATURES
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- ============================================

CreateSectionLabel(visualsTab, "Lighting")

-- Fullbright
CreateToggle(visualsTab, "Fullbright", function(state)
    if state then
        Lighting.Brightness = 2
        Lighting.ClockTime = 14
        Lighting.FogEnd = 100000
        Lighting.GlobalShadows = false
        Lighting.Ambient = Color3.fromRGB(178, 178, 178)
    else
        Lighting.Brightness = 1
        Lighting.ClockTime = 14
        Lighting.FogEnd = 10000
        Lighting.GlobalShadows = true
        Lighting.Ambient = Color3.fromRGB(0, 0, 0)
    end
end)

-- No Fog
local savedFogSettings = {}
CreateToggle(visualsTab, "No Fog", function(state)
    if state then
        savedFogSettings.FogEnd = Lighting.FogEnd
        savedFogSettings.FogStart = Lighting.FogStart
        Lighting.FogEnd = 9999999
        Lighting.FogStart = 9999999
        for _, v in pairs(Lighting:GetDescendants()) do
            if v:IsA("Atmosphere") then
                v.Density = 0
            end
        end
        for _, v in pairs(workspace:GetDescendants()) do
            if v:IsA("Atmosphere") then
                v.Density = 0
            end
        end
    else
        Lighting.FogEnd = savedFogSettings.FogEnd or 10000
        Lighting.FogStart = savedFogSettings.FogStart or 0
        for _, v in pairs(Lighting:GetDescendants()) do
            if v:IsA("Atmosphere") then
                v.Density = 0.395
            end
        end
    end
end)

-- Always Day
local dayConn
CreateToggle(visualsTab, "Always Day", function(state)
    if state then
        dayConn = RunService.Heartbeat:Connect(function()
            Lighting.ClockTime = 14
        end)
    else
        if dayConn then dayConn:Disconnect() end
    end
end)

-- Always Night
local nightConn
CreateToggle(visualsTab, "Always Night", function(state)
    if state then
        nightConn = RunService.Heartbeat:Connect(function()
            Lighting.ClockTime = 0
        end)
    else
        if nightConn then nightConn:Disconnect() end
    end
end)

CreateSectionLabel(visualsTab, "Effects")

-- Remove Water Effects
CreateToggle(visualsTab, "Remove Water Effects", function(state)
    if state then
        for _, v in pairs(Lighting:GetDescendants()) do
            if v:IsA("BlurEffect") or v:IsA("BloomEffect") or v:IsA("ColorCorrectionEffect") or v:IsA("SunRaysEffect") or v:IsA("DepthOfFieldEffect") then
                v.Enabled = false
            end
        end
        workspace.Terrain.WaterWaveSize = 0
        workspace.Terrain.WaterWaveSpeed = 0
        workspace.Terrain.WaterTransparency = 1
    else
        for _, v in pairs(Lighting:GetDescendants()) do
            if v:IsA("BlurEffect") or v:IsA("BloomEffect") or v:IsA("ColorCorrectionEffect") or v:IsA("SunRaysEffect") or v:IsA("DepthOfFieldEffect") then
                v.Enabled = true
            end
        end
    end
end)

-- No Particles / Effects
CreateToggle(visualsTab, "No Particles (FPS Boost)", function(state)
    for _, v in pairs(workspace:GetDescendants()) do
        pcall(function()
            if v:IsA("ParticleEmitter") or v:IsA("Trail") or v:IsA("Beam") or v:IsA("Fire") or v:IsA("Smoke") or v:IsA("Sparkles") then
                v.Enabled = not state
            end
        end)
    end
end)

-- Field of View Slider
CreateSlider(visualsTab, "Field of View", 70, 120, 70, function(val)
    workspace.CurrentCamera.FieldOfView = val
end)

-- ============================================
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- TELEPORT TAB FEATURES
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- ============================================

CreateSectionLabel(teleportTab, "Island Teleports")

-- GPO Island Locations
local ISLANDS = {
    ["Shells Town"] = CFrame.new(-1552, 28, 268),
    ["Orange Town"] = CFrame.new(1190, 28, 1383),
    ["Island of Rare Animals"] = CFrame.new(-1649, 28, -2547),
    ["Baratie"] = CFrame.new(-1013, 28, -3604),
    ["Arlong Park"] = CFrame.new(-2788, 30, -3283),
    ["Loguetown"] = CFrame.new(4627, 28, 2),
    ["Reverse Mountain"] = CFrame.new(2300, 600, -7150),
    ["Cactus Island / Whiskey Peak"] = CFrame.new(-1362, 28, -9547),
    ["Drum Island"] = CFrame.new(-4875, 380, -8250),
    ["Little Garden"] = CFrame.new(1040, 28, -7200),
    ["Alabasta (Sandy Island)"] = CFrame.new(-4740, 55, -5700),
    ["Jaya / Skypiea"] = CFrame.new(-3175, 28, -7150),
    ["Skypiea (Upper Yard)"] = CFrame.new(-4900, 750, -7850),
    ["Long Ring Long Land"] = CFrame.new(-6450, 28, -3900),
    ["Water 7"] = CFrame.new(-6250, 28, -5750),
    ["Thriller Bark"] = CFrame.new(-7700, 28, -6700),
    ["Fishman Island"] = CFrame.new(-58, -880, -11580),
    ["Colosseum"] = CFrame.new(-4700, 28, -11000),
    ["Dressrosa"] = CFrame.new(-5700, 28, -11000),
    ["Gravito's Fort"] = CFrame.new(-3200, 200, 3400),
    ["Marine Base"] = CFrame.new(3450, 30, 3500),
    ["Sphinx Island"] = CFrame.new(5700, 500, -5700),
    ["Sea Serpent"] = CFrame.new(0, 150, 0),
}

for name, cf in pairs(ISLANDS) do
    CreateButton(teleportTab, name, function()
        if HumanoidRootPart then
            HumanoidRootPart.CFrame = cf
        end
    end)
end

CreateSectionLabel(teleportTab, "Quick Teleports")

-- TP to Closest Devil Fruit
CreateButton(teleportTab, "TP to Closest Devil Fruit", function()
    local closest = nil
    local closestDist = math.huge
    for _, obj in pairs(workspace:GetDescendants()) do
        pcall(function()
            if (obj.Name:lower():find("fruit") or obj.Name:lower():find("devil")) then
                local part = obj:IsA("BasePart") and obj or obj:FindFirstChildWhichIsA("BasePart")
                if part then
                    local dist = (HumanoidRootPart.Position - part.Position).Magnitude
                    if dist < closestDist then
                        closestDist = dist
                        closest = part
                    end
                end
            end
        end)
    end
    if closest then
        HumanoidRootPart.CFrame = closest.CFrame * CFrame.new(0, 5, 0)
        print("[GPO Hub] Teleported to fruit: " .. closest.Name .. " (" .. math.floor(closestDist) .. "m)")
    else
        print("[GPO Hub] No devil fruits found nearby!")
    end
end)

-- TP to Closest Chest
CreateButton(teleportTab, "TP to Closest Chest", function()
    local closest = nil
    local closestDist = math.huge
    for _, obj in pairs(workspace:GetDescendants()) do
        pcall(function()
            if (obj.Name:lower():find("chest") or obj.Name:lower():find("treasure")) then
                local part = obj:IsA("BasePart") and obj or obj:FindFirstChildWhichIsA("BasePart")
                if part then
                    local dist = (HumanoidRootPart.Position - part.Position).Magnitude
                    if dist < closestDist then
                        closestDist = dist
                        closest = part
                    end
                end
            end
        end)
    end
    if closest then
        HumanoidRootPart.CFrame = closest.CFrame * CFrame.new(0, 5, 0)
        print("[GPO Hub] Teleported to chest: " .. closest.Name)
    else
        print("[GPO Hub] No chests found nearby!")
    end
end)

-- TP to Closest NPC
CreateButton(teleportTab, "TP to Closest NPC", function()
    local closest = nil
    local closestDist = math.huge
    for _, obj in pairs(workspace:GetDescendants()) do
        pcall(function()
            if obj:IsA("Model") and obj:FindFirstChildOfClass("Humanoid") and not Players:GetPlayerFromCharacter(obj) then
                local hum = obj:FindFirstChildOfClass("Humanoid")
                local hrp = obj:FindFirstChild("HumanoidRootPart") or obj:FindFirstChildWhichIsA("BasePart")
                if hrp and hum.Health > 0 then
                    local dist = (HumanoidRootPart.Position - hrp.Position).Magnitude
                    if dist < closestDist then
                        closestDist = dist
                        closest = hrp
                    end
                end
            end
        end)
    end
    if closest then
        HumanoidRootPart.CFrame = closest.CFrame * CFrame.new(0, 5, 0)
    end
end)

-- TP to Random Player
CreateButton(teleportTab, "TP to Random Player", function()
    local otherPlayers = {}
    for _, p in pairs(Players:GetPlayers()) do
        if p ~= LocalPlayer and p.Character and p.Character:FindFirstChild("HumanoidRootPart") then
            table.insert(otherPlayers, p)
        end
    end
    if #otherPlayers > 0 then
        local target = otherPlayers[math.random(1, #otherPlayers)]
        HumanoidRootPart.CFrame = target.Character.HumanoidRootPart.CFrame * CFrame.new(0, 5, 5)
        print("[GPO Hub] Teleported to: " .. target.Name)
    end
end)

-- ============================================
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- FARM TAB FEATURES
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- ============================================

CreateSectionLabel(farmTab, "Auto Farm")

-- Auto Punch NPC
local autoPunchConn
local autoPunchEnabled = false
CreateToggle(farmTab, "Auto Punch Nearest NPC", function(state)
    autoPunchEnabled = state
    if state then
        autoPunchConn = RunService.Heartbeat:Connect(function()
            if not autoPunchEnabled then return end
            pcall(function()
                local closest = nil
                local closestDist = 50
                for _, obj in pairs(workspace:GetDescendants()) do
                    if obj:IsA("Model") and obj:FindFirstChildOfClass("Humanoid") and not Players:GetPlayerFromCharacter(obj) then
                        local hum = obj:FindFirstChildOfClass("Humanoid")
                        local hrp = obj:FindFirstChild("HumanoidRootPart") or obj:FindFirstChildWhichIsA("BasePart")
                        if hrp and hum.Health > 0 then
                            local dist = (HumanoidRootPart.Position - hrp.Position).Magnitude
                            if dist < closestDist then
                                closestDist = dist
                                closest = {model = obj, hrp = hrp}
                            end
                        end
                    end
                end
                if closest then
                    -- Teleport close and simulate click
                    HumanoidRootPart.CFrame = closest.hrp.CFrame * CFrame.new(0, 0, 3)
                    -- Try to fire virtual click
                    pcall(function()
                        VirtualInputManager:SendMouseButtonEvent(0, 0, 0, true, game, 0)
                        task.wait()
                        VirtualInputManager:SendMouseButtonEvent(0, 0, 0, false, game, 0)
                    end)
                end
            end)
        end)
    else
        if autoPunchConn then autoPunchConn:Disconnect() end
    end
end)

-- Auto Farm Barrels
local autoBarrelConn
CreateToggle(farmTab, "Auto Farm Barrels", function(state)
    if state then
        autoBarrelConn = RunService.Heartbeat:Connect(function()
            pcall(function()
                for _, obj in pairs(workspace:GetDescendants()) do
                    if (obj.Name:lower():find("barrel") or obj.Name:lower():find("crate")) and obj:IsA("BasePart") then
                        local dist = (HumanoidRootPart.Position - obj.Position).Magnitude
                        if dist < 80 then
                            pcall(function()
                                firetouchinterest(HumanoidRootPart, obj, 0)
                                task.wait()
                                firetouchinterest(HumanoidRootPart, obj, 1)
                            end)
                        end
                    end
                end
            end)
        end)
    else
        if autoBarrelConn then autoBarrelConn:Disconnect() end
    end
end)

CreateSectionLabel(farmTab, "Collection")

-- Collect Nearby Items
CreateButton(farmTab, "Collect All Nearby Items", function()
    local collected = 0
    for _, obj in pairs(workspace:GetDescendants()) do
        pcall(function()
            if obj:IsA("TouchTransmitter") and obj.Parent and obj.Parent:IsA("BasePart") then
                local dist = (HumanoidRootPart.Position - obj.Parent.Position).Magnitude
                if dist < 150 then
                    firetouchinterest(HumanoidRootPart, obj.Parent, 0)
                    task.wait()
                    firetouchinterest(HumanoidRootPart, obj.Parent, 1)
                    collected = collected + 1
                end
            end
        end)
    end
    print("[GPO Hub] Collected " .. collected .. " items")
end)

-- Collect ALL Chests
CreateButton(farmTab, "Collect All Chests (TP)", function()
    local count = 0
    for _, obj in pairs(workspace:GetDescendants()) do
        pcall(function()
            if (obj.Name:lower():find("chest") or obj.Name:lower():find("treasure")) then
                local part = obj:IsA("BasePart") and obj or obj:FindFirstChildWhichIsA("BasePart")
                if part then
                    HumanoidRootPart.CFrame = part.CFrame * CFrame.new(0, 3, 0)
                    task.wait(0.3)
                    -- Try touch
                    pcall(function()
                        local tt = part:FindFirstChildOfClass("TouchTransmitter")
                        if tt then
                            firetouchinterest(HumanoidRootPart, part, 0)
                            task.wait(0.1)
                            firetouchinterest(HumanoidRootPart, part, 1)
                        end
                    end)
                    -- Also try click
                    pcall(function()
                        local cd = part:FindFirstChildOfClass("ClickDetector") or obj:FindFirstChildOfClass("ClickDetector")
                        if cd then
                            fireclickdetector(cd)
                        end
                    end)
                    count = count + 1
                end
            end
        end)
    end
    print("[GPO Hub] Visited " .. count .. " chests")
end)

-- Collect All Devil Fruits
CreateButton(farmTab, "Collect All Devil Fruits (TP)", function()
    local count = 0
    for _, obj in pairs(workspace:GetDescendants()) do
        pcall(function()
            if (obj.Name:lower():find("fruit") or obj.Name:lower():find("devil")) then
                local part = obj:IsA("BasePart") and obj or obj:FindFirstChildWhichIsA("BasePart")
                if part then
                    HumanoidRootPart.CFrame = part.CFrame * CFrame.new(0, 3, 0)
                    task.wait(0.5)
                    pcall(function()
                        firetouchinterest(HumanoidRootPart, part, 0)
                        task.wait(0.1)
                        firetouchinterest(HumanoidRootPart, part, 1)
                    end)
                    count = count + 1
                end
            end
        end)
    end
    print("[GPO Hub] Collected " .. count .. " fruits")
end)

-- ============================================
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- UTILITY TAB FEATURES
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- ============================================

CreateSectionLabel(utilityTab, "Server")

-- Anti AFK
CreateToggle(utilityTab, "Anti AFK", function(state)
    if state then
        local VirtualUser = game:GetService("VirtualUser")
        LocalPlayer.Idled:Connect(function()
            VirtualUser:CaptureController()
            VirtualUser:ClickButton2(Vector2.new())
        end)
        print("[GPO Hub] Anti-AFK enabled")
    end
end)

-- Rejoin Server
CreateButton(utilityTab, "Rejoin Server", function()
    TeleportService:Teleport(game.PlaceId, LocalPlayer)
end)

-- Server Hop
CreateButton(utilityTab, "Server Hop", function()
    local servers = {}
    local req = game:HttpService():JSONDecode(game:HttpGet("https://games.roblox.com/v1/games/" .. game.PlaceId .. "/servers/Public?sortOrder=Asc&limit=100"))
    if req and req.data then
        for _, server in pairs(req.data) do
            if server.playing < server.maxPlayers and server.id ~= game.JobId then
                table.insert(servers, server.id)
            end
        end
    end
    if #servers > 0 then
        TeleportService:TeleportToPlaceInstance(game.PlaceId, servers[math.random(1, #servers)], LocalPlayer)
    else
        print("[GPO Hub] No available servers found")
    end
end)

-- Copy Server ID
CreateButton(utilityTab, "Copy Server ID", function()
    pcall(function()
        setclipboard(game.JobId)
        print("[GPO Hub] Server ID copied: " .. game.JobId)
    end)
end)

CreateSectionLabel(utilityTab, "Player")

-- Hide Name
local nameHidden = false
CreateToggle(utilityTab, "Hide Name", function(state)
    nameHidden = state
    pcall(function()
        if Character then
            local head = Character:FindFirstChild("Head")
            if head then
                for _, v in pairs(head:GetChildren()) do
                    if v:IsA("BillboardGui") and v.Name ~= "ESP_Info" then
                        v.Enabled = not state
                    end
                end
            end
            if Character:FindFirstChild("Humanoid") then
                Character.Humanoid.DisplayDistanceType = state and Enum.HumanoidDisplayDistanceType.None or Enum.HumanoidDisplayDistanceType.Viewer
            end
        end
    end)
end)

-- FPS Booster
CreateButton(utilityTab, "FPS Booster (Remove Decor)", function()
    local removed = 0
    for _, v in pairs(workspace:GetDescendants()) do
        pcall(function()
            if v:IsA("Decal") or v:IsA("Texture") then
                v:Destroy()
                removed = removed + 1
            end
            if v:IsA("MeshPart") or v:IsA("UnionOperation") then
                v.RenderFidelity = Enum.RenderFidelity.Performance
            end
            if v:IsA("BasePart") and v.Material == Enum.Material.Grass then
                v.Material = Enum.Material.SmoothPlastic
            end
        end)
    end
    settings().Rendering.QualityLevel = Enum.QualityLevel.Level01
    print("[GPO Hub] FPS Boost applied, removed " .. removed .. " decals/textures")
end)

-- Reset Character
CreateButton(utilityTab, "Reset Character", function()
    if Humanoid then
        Humanoid.Health = 0
    end
end)

CreateSectionLabel(utilityTab, "Info")

-- Player Info Display
CreateButton(utilityTab, "Print Player Stats", function()
    print("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•")
    print("âš“ GPO Hub â€” Player Info")
    print("Name: " .. LocalPlayer.Name)
    print("Display: " .. LocalPlayer.DisplayName)
    print("Health: " .. math.floor(Humanoid.Health) .. "/" .. math.floor(Humanoid.MaxHealth))
    print("Position: " .. tostring(HumanoidRootPart.Position))
    print("Server ID: " .. game.JobId)
    print("Players: " .. #Players:GetPlayers() .. "/" .. Players.MaxPlayers)
    print("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•")
end)

-- ============================================
-- KEYBIND: TOGGLE UI
-- ============================================
UserInputService.InputBegan:Connect(function(input, processed)
    if processed then return end
    if input.KeyCode == Enum.KeyCode.RightControl then
        MainFrame.Visible = not MainFrame.Visible
    end
end)

-- ============================================
-- LOAD NOTIFICATION
-- ============================================
local NotifFrame = Instance.new("Frame")
NotifFrame.Size = UDim2.new(0, 340, 0, 70)
NotifFrame.Position = UDim2.new(0.5, -170, 0, -80)
NotifFrame.BackgroundColor3 = THEME.TOPBAR
NotifFrame.BorderSizePixel = 0
NotifFrame.Parent = ScreenGui
Instance.new("UICorner", NotifFrame).CornerRadius = UDim.new(0, 10)
local notifStroke = Instance.new("UIStroke", NotifFrame)
notifStroke.Color = THEME.ACCENT
notifStroke.Thickness = 1.5

local NotifTitle = Instance.new("TextLabel")
NotifTitle.Size = UDim2.new(1, 0, 0.5, 0)
NotifTitle.Position = UDim2.new(0, 0, 0, 4)
NotifTitle.BackgroundTransparency = 1
NotifTitle.Text = "âš“ GPO Utility Hub v3 â€” Loaded!"
NotifTitle.TextColor3 = THEME.ACCENT_BRIGHT
NotifTitle.TextSize = 15
NotifTitle.Font = Enum.Font.GothamBold
NotifTitle.Parent = NotifFrame

local NotifSub = Instance.new("TextLabel")
NotifSub.Size = UDim2.new(1, 0, 0.4, 0)
NotifSub.Position = UDim2.new(0, 0, 0.5, 0)
NotifSub.BackgroundTransparency = 1
NotifSub.Text = "Press Right Ctrl to toggle UI  â€¢  6 tabs loaded"
NotifSub.TextColor3 = THEME.TEXT_DIM
NotifSub.TextSize = 12
NotifSub.Font = Enum.Font.Gotham
NotifSub.Parent = NotifFrame

-- Animate in
TweenService:Create(NotifFrame, TweenInfo.new(0.5, Enum.EasingStyle.Quart), {Position = UDim2.new(0.5, -170, 0, 20)}):Play()
task.delay(4, function()
    TweenService:Create(NotifFrame, TweenInfo.new(0.5, Enum.EasingStyle.Quart), {Position = UDim2.new(0.5, -170, 0, -80)}):Play()
    task.wait(0.6)
    NotifFrame:Destroy()
end)

print("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•")
print("âš“ GPO UTILITY HUB v3 â€” MEGA EDITION")
print("  Loaded successfully!")
print("  Toggle UI: Right Control")
print("  Tabs: Player | ESP | Visuals | Teleport | Farm | Utility")
print("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•")
